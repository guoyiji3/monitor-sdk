# 开发指南

::: tip
版本要求：Node.js 18.17+
:::

## 克隆项目到本地

```sh
# clone 代码
git clone git@git.nykjsrv.cn:front-end/luban.git

```

## 安装依赖

在项目根目录下，打开命令窗口执行，耐心等待安装完成即可。

```sh
# 安装依赖
pnpm i
```

基于 VitePress 进行功能开发和文档记录，那么可以通过以下方式在本地启动它。

```sh
# 启动项目
pnpm run dev
```

## 插件推荐

- Eslint：检查代码质量

- Prettier：格式化代码

- Vitest：自动执行单元测试用例，以及执行单个合集或单元测试用例

- EditorConfig：保证文件格式一致

## 项目结构

```sh
.
├── meta
│   ├── contributors.json -> 贡献者名称映射
│   └── packages.json -> 描述子项目的基本信息列表
├── packages -> 源代码
│   ├── .vitepress
├── scripts -> 打包脚本相关
├── 其他配置文件
```

## 注意事项

- 在开始开发新的功能函数之前，最好先进行讨论。

- 使用 `pnpm run new` 根据命令窗口提示，完成创建功能函数。

- 在 `core` 中，尽量不要引入第三方依赖关系，尽可能让该项目轻量级。

- 根据自己的功能函数，可自行创建 `demo.vue`，用以辅助描述函数文档。

## 函数文件

函数文件通常包含以下 4 个文件：

```bash
__tests__/index.spec.ts       # vitest 测试用例
demo.vue                      # 演示文档
index.md                      # 功能文档
index.ts                      # 函数源代码本身
```

对于 index.ts，你应该导出带有名称的函数

```ts
// 应该具名导出
export { useMyFunction };

// 不应该默认导出
export default useMyFunction;
```

## 代码格式

你可以不必在意格式的问题，如果你安装了 Prettier 和 Eslint 插件，在每次保存文件时会自动进行格式化代码。

Git hooks 将在提交前运行 ESLint 和 Prettier 来格式化和修复代码，确保提交的代码符合规则。

## 单元测试

编写完代码后，添加对应的单元测试用例，尽量包含边缘情况的测试。

项目使用 vitest 作为单元测试框架，每次修改代码后，运行对应的单元测试并通过它。

## 功能文档

文档撰写，可以帮助其他开发人员更好地理解和使用项目。

在你的功能文档文件的开头添加 Frontmatter 部分，来配置页面的一些元信息。

```md
---
用于设置侧边栏的分类
category: 分类
用于设置侧边栏目录的标题
text: 标题
用于设置侧边栏目录的排序值。默认是 9999
order：9999
---
```

## 提交代码

1. 使用 `pnpm test` 命令来运行测试，确保代码的功能正常运行。

2. 使用 `pnpm run commit` 来自动生成符合规范的 git message。

3. 使用 `git push origin <branch_name>` 将本地更改推送到远程仓库的分支。

4. 打开 [远程仓库界面](https://git.nykjsrv.cn/front-end/luban) ，创建一个合并请求。

5. 在合并请求被接受并代码合并到主分支之后，将自动更新和发布项目文档。

## 发布新包

1. 使用 `pnpm test` 命令来运行测试，确保代码的功能正常运行。

   - 在发布新软件包之前，运行 `pnpm test` 命令来确保你的代码通过了所有测试用例，以验证新功能的正常运行，同时也确保之前的功能没有受到负面影响。

2. 使用 `pnpm run release` 更新项目的版本号，严格遵守语义化版本规范。

   - 在发布之前，运行 `pnpm run release` 命令来自动更新项目的版本号。确保严格遵守[语义化版本规范](https://semver.org/lang/zh-CN/)，即主版本号、次版本号和修订号的递增规则。

3. 创建合并请求（PR）。

   - 在代码修改已经准备就绪并经过测试后，创建一个合并请求（PR）以请求将这些修改合并到主分支。确保合并请求清晰地描述了所做的更改，包括功能、修复或其他改进。

4. 代码合并到主分支后，为该版本创建一个新的 Git 标签，将自动发布到 pnpm 仓库。

   - 一旦合并请求被审查并合并到主分支，为该版本创建一个新的 Git 标签，标签名称按照 **vX.X.X** 格式，其中 **X** 是数字，按照向上递增的方式命名。例如，**v1.0.0**、**v1.0.1**、**v1.1.0**。

   - 标签消息（Message）应包括发布仓库的名称和版本号，以及发布说明（Release notes）和详细修改内容，以便其他开发者了解新版本的内容。
